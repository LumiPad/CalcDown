{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "calcdown-view-chart-1.1.schema.json",
  "title": "CalcDown 1.1 Chart View",
  "type": "object",
  "$defs": {
    "axisSpec": {
      "type": "object",
      "additionalProperties": false,
      "required": ["key"],
      "properties": {
        "key": { "type": "string", "minLength": 1 },
        "label": { "type": "string" },
        "kind": { "enum": ["line", "bar", "column"] },
        "area": { "type": "boolean" },
        "format": {
          "oneOf": [
            { "enum": ["number", "integer", "percent", "percent01", "currency", "date"] },
            {
              "type": "object",
              "additionalProperties": false,
              "required": ["kind"],
              "properties": {
                "kind": { "enum": ["number", "integer", "percent", "currency", "date"] },
                "digits": { "type": "integer", "minimum": 0, "maximum": 12 },
                "scale": { "type": "number", "exclusiveMinimum": 0 },
                "currency": { "type": "string", "minLength": 1 }
              }
            }
          ]
        }
      }
    }
  },
  "additionalProperties": false,
  "required": ["id", "type", "source", "spec"],
  "properties": {
    "id": { "type": "string", "minLength": 1 },
    "type": { "const": "chart" },
    "library": { "type": "string", "const": "calcdown", "default": "calcdown" },
    "source": { "type": "string", "minLength": 1 },
    "spec": {
      "type": "object",
      "additionalProperties": false,
      "required": ["kind", "x", "y"],
      "properties": {
        "title": { "type": "string" },
        "kind": { "enum": ["line", "bar", "column", "combo"] },
        "x": { "$ref": "#/$defs/axisSpec" },
        "y": {
          "oneOf": [
            { "$ref": "#/$defs/axisSpec" },
            { "type": "array", "minItems": 1, "items": { "$ref": "#/$defs/axisSpec" } }
          ]
        }
      },
      "allOf": [
        {
          "if": { "properties": { "kind": { "const": "combo" } } },
          "then": {
            "properties": {
              "y": { "type": "array", "minItems": 2, "items": { "$ref": "#/$defs/axisSpec" } }
            }
          }
        }
      }
    }
  }
}
